============
更新记录
============

- 2018.04.28
    * 优化版本,增加走路不加密

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2018.03.12
    * Player.lua 增加
    ::

        function OnUserHit(PlayP, HitdP, ...)
        end

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2018.01.16
    * Player.lua 增加
    ::

        # 无参数 适合地图提示 其他一些反复事件
        function OnSysTime()
        end
    * 一次性定时功能
    ::

        # Index 索引 iTick 时间(10毫秒) Tips 提示信息
        PlayerList.SetEventTick(Index, iTick, Tips)

        # 对应触发语句 arg[1]是索引 arg[2]是提示文字
        function OnSysEventTick(...)
        end

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2018.01.11
    * 修复Player.lua拥有 OnGetResult 导致老脚本的OnGetResult可能引起的无法触发

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2018.01.04
    * 服务器对调用的脚本函数增加保护
    * 提供玩家在线改名功能,需要支付费用绑定机器 (私密群主,群主不主动私密)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.12.26
    * 修改log文件跟随执行文件同名
    * 修复script脚本扣除装备时,扣除失败问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.12.12
    * 修复三层的bug
    * 修复心法不起bug

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.12.04
    * 脚本获取的ItemData增加Grade字段
    * 去除上个版本攻击缓慢
    * 增加关闭tgs时自动调用菜单File->close命令,尽量避免数据丢失可能
    * 调整HookCallFunc对OnUserSay的调用,回调请使用return 使用return 'true'可能导致其他调用失败
    * 菜单增加赞助,此项随用,有兴趣的可以支持！

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.11.25
    * 调整OnItemInfoShow相关

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.10.18
    * 调整攻击转身去除防闪打功能 还原原始设定
    * 修改脚本设定0团队问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.09.20
    * 修正关闭tgs时玩家在线会弹错 推荐正常关闭流程 菜单File->Exit

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.09.19
    * 修改luascriptlist.sdb 索引不要求顺序只要不重复就ok，脚本编号依然是 索引+10000
    * 增加在线数据功能 避免玩家在DB存档间歇，登录角色读取的非最后数据引起的物品回档
    :注: 勾选在线数据，玩家上线内存将存档一份数据 玩家重新上线将读取内存数据

    .. attention ::
        + 勾选了在线数据 修改DB的角色数据将无效
    * 修复之前大量角色掉线，服务器数据卡死问题
    * N版本之前的门主不在线 门石掉血问题 早已修复，不算本次更新

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.09.12
    * 调整Player.SetEventTick(PlayP, aIndex, 时间间隔, aTips) 增加文字传入
    * 调整Player.lua function OnEventTick(PlayP, aIndex, aTips) 增加 aTips参数
    :注: 可以通过 aTips实现Npc脚本和Player互通

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2017.05.22
    * 修复上个版本的一个数据保存缺陷
    * Npc.sdb 增加字段 Guild,Groupkey 请自行增加，功能参考monster.sdb

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.12.15
    * 普通攻击武功支持Function 功能<1 2 3 4 5> 但是只有4和5时 MinRange 有效
    :注: 1 还生模式 2 灵动八方 3 风灵旋 4 灵动增强版 5 打击一条线模式

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.12.07
    * 增加语句 @重载脚本  主要用于脚本编写测试
    * 修改luascriptlist.sdb 增加或修改信息 使用此语句即时生效

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.10.24
    * 修复小地图显示问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.06.22
    * 增加脚本语句 Player.SetEventTick(PlayP, 时序编号, 间隔时间(10毫秒))
    :注: 当间隔时间倒计时为0之后,触发OnEventTick 同时此时序编号消失 需要重新设定

    * Player.lua 增加
    ::

        # arg[1] 时序编号
        function OnEventTick(PlayerP, ...)
        end
    :注: 当触发这里时 表示 SetEventTick 已经完成时间倒计时

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.05.28
    * 修复门石掉血问题
    * 调整新建门派血量 不在超出1100000

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.05.12
    * 修复门武申请 取消门武会卡住问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.04.16
    * 修复04.01版本bug

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.04.01
    * 脚本 TeamManager 系列生效。

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.03.26
    * 增加 Player.GetStatePoint(PlayP) 获取玩家真气值
    * 增加 Player.SetStatePoint(PlayP, GetNum + 1) 设定玩家真气值

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.02.24
    * 调整优化物品多货币

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.02.05
    * 增加NPC买卖物品 多种货币
    * Item.sdb 增加字段 SellCoin, BuyCoin
    :注: 字段为空 默认游戏钱币 填写存在的物品名字 购买就需要对应的物品

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.01.08
    * 增加界面发送信息，文件名为GMSay.txt与tgs同目录 喊话在屏幕中央
    * 修正 Player.SetPowerLevel 点击玩家境界不同步问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.01.02
    * 修正头防显示问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2016.01.01
    * 修正戒指活力设定过高引发三防无法满值问题
    * 修正Npc.AddPlayToGuild
    * 当活力超过655.35时 服务器只传递655.35给客户端 避免客户端显示错乱
    :注: 客户端默认显示只支持655.35 超过就错乱

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.12.17
    * 取消 Player.SetAddAttrib 对三防的额外添加，避免一些特殊问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.12.03
    * 调整Player.GetMagicSkill 支持三层武功 但是不支持查询三层武功等级

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.11.19
    * 修复10.30更新出现的bug

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.10.30
    * Player.lua 增加 新用户登录拦截
    ::

        function OnNewUserLogin(PlayP, ...)
        end
    * 增加语句 Player.SetUserNewId(PlayP, int) 修改玩家id 不支持负数

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.10.17
    * 修复门武部分信息不保存问题
    * Player.lua 增加门派创建拦截
    ::

        # arg[1] 玩家名字, arg[2] 门派名字
        function OnMakeGuild(PlayP, ...)
        end
    :注: return '' 表示创建门派继续 否则返回的字符将被门派提示出来作为创建门派失败的原因

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.05.26
    * 调整物品交易记录信息, 提供相关解析工具。
    * 优化 @show xxx 命令

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.04.03
    * 调整支持 tgs2011.acs 提示字符可以被调整了

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.03.17
    * 修复 Player.SetAddAttribData

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.03.05
    * 恢复调用lua51 文件夹的5.3的dll 请删除

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2015.03.01
    * 调整真气三段
    ::

        # Game.ini
        [setting]
        真气1=1
        真气2=2
        真气3=3
    * 招式使用卡状态问题修复。
    * 调整lua 支持5.3 对应脚本需要调整
        默认的语句带有...的原始直接用arg参数 需修在函数语句下增加一句 local arg = {...}
        table.getn(xx) 全部需要改成 #xx
        其他语句问题 请参考tgs1000.log
        lua调用的第三方dll都需要同步到lua5.3版 正常不调用

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.12.25
    * 添加爆率修改界面

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.12.18
    * 修复Sql.GetTabSql()
    ::

        local GetTab = Sql.GetTabSql('select * from NewPlay')
        for k, v in pairs(GetTab) do
            if type(v) == 'table' then
                for k1, v1 in pairs(v) do
                    Player.SendChatMsg(PlayerP, k1..'->'..v1, 2)
                end
            end
        end

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.10.06
    * 调整真气获取功能

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.07.31
    * 调整 Player.DelMagicItem(PlayerP, '生药:100', true)
    :注: 如果第三个参数是 true 就不考虑段数和黄字相同 直接判断物品名字和数量
    * BasicObj.GetAllPlayP() 返回玩家列表
    ::

        local AllPlayTab = BasicObj.GetAllPlayP()
        AllPlayTab = {
            ['角色名字']=角色P,
        }
        角色P指类似PlayerP这类

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.06.23
    * 修正当地图编号超出255， 玩家下线再上地图编号错误问题。

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.04.01
    * 增加 function OnChangeMagic(PlayP, ...)
    * 调整招式特效持续时间

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2014.02.28
    * 调整招式武功特效问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.12.18
    * 增加支持Npc爆出公告
    * 调整兼容360软件

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.12.17
    * help文件夹支持子目录

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.12.16
    * 调整地图时间超出1小时的提示错误

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.11.15
    * 修复版本系列武功满就出错问题
    * 修复套装回血问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.09.17
    * Player.lua 增加
    ::

        # 当玩家拾取物品时 就会触发这个
        function OnPickUpItem(PlayP, CharName, ItemData)
            Player.SendChatMsg(PlayP, CharName..ItemData.Name, 2)
            # 发周围信息
            Player.SendARoundChatMsg(PlayP, CharName..' 测试消息 '..ItemData.Name, 31, 32767)
        end

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.08.12
    * 增加脚本语句 Player.GetAreaName(PlayP) //返回字符串

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.08.06
    修复Player.Say脚本语句

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.07.28
    * 修复wpe发某数据包，服务器加速检测失效bug

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.07.27
    * 增加月卡模式
    ::

        # Game.ini
        [setting]
        月卡模式=1
    * 增加脚本语句
    ::

        # 返回当前时间类型数字 和 时间字符串
        Player.GetPlayInfo(PlayP)
        # 类型 0 免费 1 三天体验 2 付费 3 试玩时间 4 无时间
        Player.SetPlayInfo(PlayP, 时间类型, 分钟)

    * 示例脚本
    ::

        function OnUserStart(PlayerP)
            # 检查玩家游戏时间
            local PayType, PayTime = Player.GetPlayInfo(PlayerP)
            # 玩家无时间 就给5分钟试玩时间
            if PayType == 4 then
                # 给玩家增加试玩时间 5分钟  3->试玩, 5->单位分钟
                Player.SetPlayInfo(PlayerP, 3, 5)
            end
        end

        function OnUserSay(PlayerP, ...)
            if arg[1] == '@充值' then
                # 给玩家增加游戏世界 2是游戏时间 30 * 24 * 60 是30天
                Player.SetPlayInfo(PlayerP, 2, 30 * 24 * 60)
                return 'true'
            end
        end

    * 修复月卡上线无法判断时间问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.07.26
    * 修复采药，采矿无法采集问题。

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.07.13
    * 增加默认上线开启双倍功能
    ::

        # Game.ini
        [setting]
        开启双倍 = 1
    * 修复获取双倍经验 有时间 但是开启双倍没时间的bug
    * 对Player.SetAddAttribData进行调整 增加防溢出处理 避免设定过大导致服务器处理错误
    :注: 默认索引从0开始 不要跨数值设定，否则会引发异常
    :注: 如果有设定部分，没有加成时请给玩家设定0 不要跳过设定

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.06.25
    * 修正北海冰玉清洗装备id变更问题
    * 修正脚本删除武功无法删除掌风栏问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.06.12
    * 修正服务器错误时 提示'%d' 不能正确写错误到tgs1000.log

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.06.11
    * 增加 Player.Say(PlayP, 'test')

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.06.09
    * 修改一个服务器踢玩家断线可能引发爆机问题。
    * 开放http的功能，不再需要注册。

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.04.25
    * 根据www.lanlong.net提供的隐身方案，服务器针对性屏蔽

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.04.12
    * 更新解决一个可能致命的bug

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.04.06
    * 增加界面勾选按钮相<门战时 无门派玩家不可以攻击门石> 此配置不保存

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.04.03
    * 调整判断为加速时 定身时间 单位10毫秒
    ::

        # Game.Ini
        [SETTING]
        加速定身=1

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.03.25
    * 修正Player.GetItemPassWord 获取信息不正确问题
    * GetMagicSkillLevel 支持查看掌风等级

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.03.13
    * 修改lua脚本返回值判断，如果脚本执行出现错误，则返回值为空 同时写错误信息到tgs1000.log中 错误信息包含调用的语句名字比如 OnClick 错误信息
    * 增加调整玩家境界语句 Player.SetPowerLevel(PlayP, 境界数字)
    :注: 如果境界数字小于0 就设定为0境界 大于最大境界就设定为最大境界

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.03.06
    * 修正变身不能点击带脚本的物品

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.03.04
    * 修改未建门门石 门石拥有者或gm可以拾取

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.03.02
    * 修改交易提示，从原始名字改成显示名字

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.02.28
    * 修复OnDropItem的bug

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.02.26
    * 更新脚本语句DeleteMagicByName 支持删除3层护体和武功
    * 增加 Player.AddAdaptive(PlayP, 10000) 增加耐性
    * 增加 Player.AddVirtue(PlayP, 10000) 增加浩然

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.01.22
    * 增加跨服喊话配置
    ::

        # sv1000.ini
        [UDP_CROSSSAY]
        PORT=4560
        IPADDRESS=127.0.0.1
        LOCALPORT=1599
    * 增加跨服喊话转发程序 端口配置见默认生成的ini
    :注: 脚本参考Player.lua 和 跨服喊话.lua
    * 增加脚本语句
    ::

        # 返回布尔类型  跨服喊话
        Manager.CrossServerSay(前景色, 背景色, 发送内容)

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.01.20
    * 更新http参数获取问题

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.01.19 sp1
    * 修正未开通http服务器时 程序报错问题
    * 修正更新相关里面的错误描述

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

- 2013.01.19
    * 根据太极版本测试出现的问题
    * 服务器对传入的 NpcP, PlayP之类增加了校验。如果错误将执行语句

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *

~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

-
    *
